{
  "name": "My workflow 6",
  "nodes": [
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "list",
        "queryFilters": {
          "name": [
            {}
          ],
          "mimeType": [
            {}
          ]
        },
        "options": {}
      },
      "name": "Get Reels1",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 1,
      "position": [
        -460,
        1340
      ],
      "id": "c8a5ecb1-5a0f-488a-8b37-6baecd84c8fe",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Vt1qBhoNFddDaUnc",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const files = items[0].json.files;\nconst idx = Math.floor(Math.random()*files.length);\nreturn [{json:{fileId: files[idx].id, fileName: files[idx].name, download: files[idx].webContentLink}}];"
      },
      "name": "Pick Random1",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -260,
        1340
      ],
      "id": "8fc8ba8b-0201-4412-9258-93b4181b9a09"
    },
    {
      "parameters": {
        "command": "ffmpeg -i input.mp4 \\\n    -vf \"drawbox=x=0:y=0:w=iw:h=ih:color=red@0.5:t=fill, \\\n         drawtext=text='{{timestamp}}':fontcolor=white:x=(w-text_w)/2:y=10\" \\\n    -y output.mp4"
      },
      "name": "Add Frame1",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        -60,
        1340
      ],
      "id": "d2073130-eade-4db7-b93c-576842c67799"
    },
    {
      "parameters": {
        "authentication": "airtableTokenApi",
        "operation": "list",
        "application": {
          "__rl": true,
          "mode": "id",
          "value": ""
        },
        "table": {
          "__rl": true,
          "value": "accounts",
          "mode": ""
        },
        "additionalOptions": {}
      },
      "name": "Get Accounts1",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 1,
      "position": [
        140,
        1340
      ],
      "id": "aeb9f2ad-bdd8-47eb-9ff9-8a07674acbc0",
      "credentials": {
        "airtableTokenApi": {
          "id": "j0A9W6lTtOFzjTdr",
          "name": "Reels Завод"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "return Math.random() < 0.5 ? [{json:{branch: 'GPT'}}] : [{json:{branch: 'Competitor'}}];"
      },
      "name": "Choose Source1",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        340,
        1340
      ],
      "id": "a5b805da-910b-4bad-8a2d-a440d16a75a9"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json[\"branch\"]}}",
              "value2": "GPT"
            }
          ]
        }
      },
      "name": "IF GPT1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        540,
        1260
      ],
      "id": "3e87c003-a40e-408e-8d60-7cbd92206d37"
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "jsonParameters": true,
        "options": {}
      },
      "name": "GPT Generate1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        740,
        1160
      ],
      "id": "cea1d953-6f11-4403-9a99-475b931484ea"
    },
    {
      "parameters": {
        "url": "=https://www.instagram.com/{{$json.account}}/reels/",
        "options": {}
      },
      "name": "Fetch Competitor Reels1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        740,
        1360
      ],
      "id": "13213b4e-1082-4184-a5a5-b0a2527a02fa"
    },
    {
      "parameters": {
        "functionCode": "// filter for viral reel\nconst reels = items[0].json.reels || [];\nconst good = reels.filter(r => r.views / r.followers > 1.5);\nconst pick = good[Math.floor(Math.random()*good.length)];\nreturn [{json:{title: pick.title, description: pick.description, music: pick.music}}];"
      },
      "name": "Select Viral1",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        940,
        1360
      ],
      "id": "73045656-49a8-4f43-8445-abcfcaa3a267"
    },
    {
      "parameters": {
        "functionCode": "return items;"
      },
      "name": "Caption Source1",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1140,
        1260
      ],
      "id": "83406dfa-0bec-47e6-bb51-8e79c5064bac"
    },
    {
      "parameters": {
        "authentication": "airtableTokenApi",
        "operation": "list",
        "application": "airtable",
        "table": "history",
        "additionalOptions": {}
      },
      "name": "Check Duplicate1",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 1,
      "position": [
        1340,
        1260
      ],
      "id": "50b796b7-194f-4ca6-aaae-dee4d722b8fb",
      "credentials": {
        "airtableTokenApi": {
          "id": "j0A9W6lTtOFzjTdr",
          "name": "Reels Завод"
        }
      }
    },
    {
      "parameters": {
        "authentication": "airtableTokenApi",
        "operation": "append",
        "application": "airtable",
        "table": "history",
        "options": {}
      },
      "name": "Save Record1",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 1,
      "position": [
        1540,
        1260
      ],
      "id": "b9c6326e-1af3-42ae-b191-11cc7da7579c",
      "credentials": {
        "airtableTokenApi": {
          "id": "j0A9W6lTtOFzjTdr",
          "name": "Reels Завод"
        }
      }
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://api.autoposting.com/reels",
        "jsonParameters": true,
        "options": {}
      },
      "name": "Publish Reel1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        1740,
        1260
      ],
      "id": "e7dcc5a6-1cb1-4ae6-acf6-bcc4126aef55"
    },
    {
      "parameters": {
        "authentication": "airtableTokenApi",
        "operation": "update",
        "application": "airtable",
        "table": "history",
        "options": {}
      },
      "name": "Update Status1",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 1,
      "position": [
        1940,
        1260
      ],
      "id": "b371d95e-ad60-4ae5-876c-b94b7744e1b2",
      "credentials": {
        "airtableTokenApi": {
          "id": "j0A9W6lTtOFzjTdr",
          "name": "Reels Завод"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Get Reels1": {
      "main": [
        [
          {
            "node": "Pick Random1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pick Random1": {
      "main": [
        [
          {
            "node": "Add Frame1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Frame1": {
      "main": [
        [
          {
            "node": "Get Accounts1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Accounts1": {
      "main": [
        [
          {
            "node": "Choose Source1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Choose Source1": {
      "main": [
        [
          {
            "node": "IF GPT1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF GPT1": {
      "main": [
        [
          {
            "node": "GPT Generate1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fetch Competitor Reels1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GPT Generate1": {
      "main": [
        [
          {
            "node": "Caption Source1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Competitor Reels1": {
      "main": [
        [
          {
            "node": "Select Viral1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select Viral1": {
      "main": [
        [
          {
            "node": "Caption Source1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Caption Source1": {
      "main": [
        [
          {
            "node": "Check Duplicate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Duplicate1": {
      "main": [
        [
          {
            "node": "Save Record1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Record1": {
      "main": [
        [
          {
            "node": "Publish Reel1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Publish Reel1": {
      "main": [
        [
          {
            "node": "Update Status1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "c81eca6c-062b-40b5-a080-2559957e5f51",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "03802800ec9728491c300edb92e0138d87d9dcbbfccb74620634ca050fae6138"
  },
  "id": "z0jH8wDyhCZwTN2f",
  "tags": []
}
